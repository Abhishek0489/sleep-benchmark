# -*- coding: utf-8 -*-
"""Main-model-train.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1J3lWB3ia0rHhRZavMmNe-OppZ2vqRxYy

# Importing the libraries
"""

import numpy as np
import pandas as pd
#import matplotlib.pyplot as plt
import pickle

"""#importing the data set"""

dataset = pd.read_csv('updated_sleep_data.csv')
X = dataset.iloc[ : , 1:-1].values
y=dataset.iloc[: ,-1].values

#print(dataset)

# print(X)
#deep_data =[['Female' , 21 , 'Software Engineer' , 9.2 , 7 , 30 ,6 ,'Overweight' ,72 , 1000 , 120 ,80]]

# print(X[0 , :])

# print(y)

"""# checking for missing value

# replacing nan value

# One hot Encoding
"""

from sklearn.compose import ColumnTransformer
from sklearn.preprocessing import OneHotEncoder
ct = ColumnTransformer(transformers=[('encoder', OneHotEncoder(sparse_output=False), [0 , 2 , 7])], remainder='passthrough')
X = np.array(ct.fit_transform(X))

# print(X[0 , :])



#deep = ct.transform(deep_data)

#print(deep)

# print(X[0 ,:])

# print(X[16 ,:])

"""# label encoding the dependent varaible

"""

from sklearn.preprocessing import LabelEncoder
le = LabelEncoder()
y = le.fit_transform(y)

# print(y)

"""# splitting into training and test ste

"""

from sklearn.model_selection import train_test_split
X_train , X_test , y_train ,y_test = train_test_split(X,y  , test_size=0.2 , random_state=0)

# print(X_test)
# print(len(X_test))

# print(X_train)
# print(len(X_train))



"""# KNN

# Decision Tree
"""

from sklearn.tree import DecisionTreeClassifier
classifierDT = DecisionTreeClassifier(criterion = 'entropy', random_state = 0)
classifierDT.fit(X_train, y_train)

"""#SAVING THE MODEL

"""

# --- START: ADD THIS BLOCK TO SAVE YOUR FILES ---
with open('model.pkl', 'wb') as f:
    pickle.dump(classifierDT, f)

with open('preprocessor.pkl', 'wb') as f:
    pickle.dump(ct, f)

with open('label_encoder.pkl', 'wb') as f:
    pickle.dump(le, f)

print("model.pkl, preprocessor.pkl, and label_encoder.pkl have been saved.")
# --- END: ADD THIS BLOCK ---

"""#RESULT AND PREDICTION"""

y_pred = classifierDT.predict(X_test)
print(np.concatenate((y_pred.reshape(len(y_pred),1), y_test.reshape(len(y_test),1)),1))

from sklearn.metrics import confusion_matrix, accuracy_score
cm = confusion_matrix(y_test, y_pred)
print(cm)
print('printing the accuracy score')
print(accuracy_score(y_test, y_pred))
#print('\n')
#print('deep sleep disorder = ' ,classifierDT.predict(deep))